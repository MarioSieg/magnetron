# Magnetron Operator Reference

All operations in Magnetron are exposed as **methods on `Tensor`**.
If you are familiar with PyTorch, think `x.sin()` instead of `torch.sin(x)`.

---

## Tensor Creation & Initialization

| Method | Category | Description | Math | Example |
|------|----------|-------------|------|---------|
| `Tensor.empty(shape)` | Creation | Create an uninitialized tensor (contents undefined) | N/A | `x = Tensor.empty(2, 3)` |
| `Tensor.empty_like(x)` | Creation | Create an uninitialized tensor with same shape and dtype as input | N/A | `y = Tensor.empty_like(x)` |
| `Tensor.full(shape, v)` | Creation | Create tensor filled with constant value | $x_i = v$ | `x = Tensor.full((2,3), 1.0)` |
| `Tensor.full_like(x, v)` | Creation | Create constant-filled tensor like input | $x_i = v$ | `y = Tensor.full_like(x, 0)` |
| `Tensor.zeros(shape)` | Creation | Create tensor filled with zeros | $x_i = 0$ | `x = Tensor.zeros(2,3)` |
| `Tensor.ones(shape)` | Creation | Create tensor filled with ones | $x_i = 1$ | `x = Tensor.ones(4)` |
| `Tensor.arange(a,b,s)` | Creation | Create evenly spaced values from start to stop | $a, a+s, \dots < b$ | `x = Tensor.arange(0, 10, 2)` |
| `Tensor.rand_perm(n)` | Random | Random permutation of integers | permutation of $\{0..n-1\}$ | `x = Tensor.rand_perm(10)` |
| `Tensor.one_hot(c)` | Encoding | Convert indices to one-hot vectors | $y_{i,j}=[x_i=j]$ | `y = idx.one_hot(10)` |
| `Tensor.load_image(p)` | IO | Load image file into tensor | N/A | `img = Tensor.load_image("img.png")` |

---

## Filling & Mutation

| Method | Category | Description | Math | Example |
|------|----------|-------------|------|---------|
| `fill_(v)` | Fill | Fill tensor in-place with constant value | $x_i=v$ | `x.fill_(0)` |
| `zeros_()` | Fill | In-place fill with zeros | $x_i=0$ | `x.zeros_()` |
| `ones_()` | Fill | In-place fill with ones | $x_i=1$ | `x.ones_()` |
| `copy_(y)` | Copy | Copy data from another tensor | $x=y$ | `x.copy_(y)` |
| `masked_fill(mask,v)` | Fill | Replace values where mask is true | $x_i=v$ if $m_i$ | `y = x.masked_fill(m,0)` |
| `masked_fill_(mask,v)` | Fill | In-place masked fill | N/A | `x.masked_fill_(m,0)` |
| `uniform_(a,b)` | Random | Fill with uniform random values | $x\sim U(a,b)$ | `x.uniform_(0,1)` |
| `normal_(μ,σ)` | Random | Fill with normal distribution | $x\sim\mathcal N(\mu,\sigma)$ | `x.normal_(0,1)` |
| `bernoulli_(p)` | Random | Fill with Bernoulli samples | $x\sim\text{Bern}(p)$ | `x.bernoulli_(0.5)` |

---

## Shape, Views & Indexing

| Method | Category | Description | Math | Example |
|------|----------|-------------|------|---------|
| `clone()` | Memory | Create a deep copy of the tensor | N/A | `y = x.clone()` |
| `cast(dtype)` | Type | Cast tensor to another data type | N/A | `x.cast(dtype.float16)` |
| `view(shape)` | View | Create a view with new shape | N/A | `x.view(2, -1)` |
| `view_slice(d,s,l)` | View | Slice tensor without copying | $x[s:s+l]$ | `x.view_slice(0,0,4)` |
| `reshape(shape)` | Shape | Reshape tensor (may copy) | N/A | `x.reshape(4,3)` |
| `transpose(a,b)` | Shape | Swap two dimensions | $x^T$ | `x.transpose(0,1)` |
| `permute(dims)` | Shape | Reorder dimensions arbitrarily | N/A | `x.permute(1,0,2)` |
| `contiguous()` | Memory | Ensure tensor is contiguous in memory | N/A | `x = x.contiguous()` |
| `squeeze()` | Shape | Remove dimensions of size 1 | N/A | `x.squeeze()` |
| `unsqueeze(d)` | Shape | Insert new dimension | N/A | `x.unsqueeze(0)` |
| `flatten(a,b)` | Shape | Flatten a range of dimensions | N/A | `x.flatten(1)` |
| `unflatten(s)` | Shape | Expand flattened dimension | N/A | `x.unflatten((2,3))` |
| `narrow(d,s,l)` | Index | Take slice along dimension | N/A | `x.narrow(1,0,4)` |
| `movedim(a,b)` | Shape | Move dimension to new position | N/A | `x.movedim(0,-1)` |
| `select(d,i)` | Index | Select single index along dim | $x[...,i]$ | `x.select(1,2)` |
| `split(n,d)` | Shape | Split tensor into chunks | N/A | `x.split(4,1)` |
| `cat(xs,d)` | Shape | Concatenate tensors | N/A | `Tensor.cat([a,b],1)` |
| `gather(d,idx)` | Index | Gather elements by index tensor | $y_i=x_{idx_i}$ | `x.gather(1,idx)` |

---

## Reductions

| Method | Category | Description | Math | Example |
|------|----------|-------------|------|---------|
| `mean()` | Reduction | Compute mean over elements | $\frac1N\sum x$ | `x.mean()` |
| `sum()` | Reduction | Sum elements | $\sum x$ | `x.sum()` |
| `prod()` | Reduction | Product of elements | $\prod x$ | `x.prod()` |
| `min()` | Reduction | Minimum value | $\min(x)$ | `x.min()` |
| `max()` | Reduction | Maximum value | $\max(x)$ | `x.max()` |
| `argmin()` | Reduction | Index of minimum | $\arg\min(x)$ | `x.argmin()` |
| `argmax()` | Reduction | Index of maximum | $\arg\max(x)$ | `x.argmax()` |
| `any()` | Reduction | True if any element is non-zero | $\exists x_i\neq0$ | `x.any()` |
| `all()` | Reduction | True if all elements are non-zero | $\forall x_i\neq0$ | `x.all()` |

---

## Unary Math Operations

| Method    | Category | Description | Math               | Example |
|-----------|----------|-------------|--------------------|--------|
| `abs()`   | Math | Absolute value | $\vert x \vert$         | `x.abs()` |
| `neg()`   | Math | Negation | $-x$               | `-x` |
| `sqr()`   | Math | Square | $x^2$              | `x.sqr()` |
| `rcp()`   | Math | Reciprocal | $\frac1x$          | `x.rcp()` |
| `sqrt()`  | Math | Square root | $\sqrt{x}$         | `x.sqrt()` |
| `rsqrt()` | Math | Inverse sqrt | $\frac1{\sqrt{x}}$ | `x.rsqrt()` |
| `log()`   | Math | Natural logarithm | $\ln(x)$           | `x.log()` |
| `exp()`   | Math | Exponential | $e^x$              | `x.exp()` |
| `floor()` | Math | Floor | $\lfloor x\rfloor$ | `x.floor()` |
| `ceil()`  | Math | Ceil | $\lceil x\rceil$   | `x.ceil()` |
| `round()` | Math | Round to nearest int | round$(x)$         | `x.round()` |

---

## Binary Arithmetic

| Method | Operator | Description | Math | Example |
|------|----------|-------------|------|---------|
| `add()` | `+` | Elementwise addition | $x+y$ | `x + y` |
| `sub()` | `-` | Elementwise subtraction | $x-y$ | `x - y` |
| `mul()` | `*` | Elementwise multiplication | $x\cdot y$ | `x * y` |
| `div()` | `/` | Elementwise division | $\frac{x}{y}$ | `x / y` |
| `mod()` | `%` | Elementwise modulus | $x\bmod y$ | `x % y` |
| `matmul()` | `@` | Matrix multiplication | $XY$ | `x @ y` |

---

## Logical & Bitwise

| Method | Operator | Description | Math | Example |
|------|----------|-------------|------|---------|
| `logical_and()` | `&`      | Elementwise AND | $x\land y$ | `x & y` |
| `logical_or()` | `\|`     | Elementwise OR | $x\lor y$ | `x \| y` |
| `logical_xor()` | `^`      | Elementwise XOR | $x\oplus y$ | `x ^ y` |
| `logical_not()` | `~`      | Elementwise NOT | $\lnot x$ | `~x` |
| `shl()` | `<<`     | Shift left | $x\ll k$ | `x << 1` |
| `shr()` | `>>`     | Shift right | $x\gg k$ | `x >> 1` |

---

## Matrix Utilities

| Method | Category | Description | Math | Example |
|------|----------|-------------|------|---------|
| `tril()` | Matrix | Lower-triangular matrix | $i\ge j$ | `x.tril()` |
| `triu()` | Matrix | Upper-triangular matrix | $i\le j$ | `x.triu()` |